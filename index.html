<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase Chat</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        #chat-app {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        #messages {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
        }
        .message {
            margin-bottom: 5px;
        }
        .message .sender {
            font-weight: bold;
        }
    </style>
</head>
<body>
<div id="chat-app">
    <h2>Supabase Chat</h2>
    <label for="roomInput">Enter Room Code:</label>
    <input type="text" id="roomInput" placeholder="e.g., myRoom123">
    <button id="joinRoom">Join Room</button>
    <button id="createRoom">Create Room</button>
    
    <div id="chatSection" style="display: none;">
        <h3>Room: <span id="roomName"></span></h3>
        <div id="messages"></div>
        <input type="text" id="messageInput" placeholder="Type your message">
        <button id="sendMessage">Send</button>
    </div>
</div>

<script>
    const supabaseUrl = "YOUR_SUPABASE_URL";
    const supabaseKey = "YOUR_SUPABASE_ANON_KEY";
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);
    
    let currentRoom = null;
    let currentUser = prompt('Please enter your name:') || 'Anonymous';

    document.getElementById('createRoom').addEventListener('click', async () => {
        const roomName = prompt('Enter a new room name:');
        if (roomName) {
            await supabase.from('rooms').insert([{ name: roomName }]);
            alert(`Room "${roomName}" created successfully!`);
        }
    });

    document.getElementById('joinRoom').addEventListener('click', async () => {
        const roomCode = document.getElementById('roomInput').value.trim();
        if (roomCode) {
            currentRoom = roomCode;
            document.getElementById('chatSection').style.display = 'block';
            document.getElementById('roomName').textContent = currentRoom;
            loadMessages();
        } else {
            alert('Please enter a valid room code.');
        }
    });

    async function loadMessages() {
        const { data: messages, error } = await supabase
            .from('messages')
            .select('*')
            .eq('room', currentRoom);
        
        if (!error) {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            messages.forEach(msg => addMessage(msg.sender, msg.content));
        }
    }

    document.getElementById('sendMessage').addEventListener('click', async () => {
        const messageInput = document.getElementById('messageInput');
        const message = messageInput.value.trim();
        if (currentRoom && message) {
            await supabase.from('messages').insert([{ room: currentRoom, sender: currentUser, content: message }]);
            addMessage(currentUser, message);
            messageInput.value = '';
        }
    });

    function addMessage(sender, content) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message');
        messageDiv.innerHTML = `<span class="sender">${sender}:</span> ${content}`;
        document.getElementById('messages').appendChild(messageDiv);
    }
</script>
</body>
</html>
